# TEMPLATE MASTER BY MYSH (git.hugmouse.com)
~version: "2.0"
?path: /.+
site_name: "Tenisový svět"
# $(NBSP) FIXER
@replace("^\\s+$", ""): //text()

$tournament: //div[@class="tournament-heading"]
?exists: $tournament
$body: $tournament
$img: $tournament//img
image_url: $img/@src
@remove: $img
#@append_to($body): $img

$table: //*[has-class("user-detail-bio")]
$row: $table//div[has-class("col-xs-6")]
$td: $table//div[has-class("col-xs-6")]/*


@wrap(<td>): $td

$td: $table//div[has-class("col-xs-12")]/*
@remove:  $table//div[has-class("col-xs-12")]/span


@wrap(<td>): $td
$get: $@
<tr>: $row
<tr>: $table//div[has-class("col-xs-12")]
@debug
@wrap_inner(<table>): $table
$h2: $table//h2
#@wrap(<strong>): $h2

?true:

$tournament: //div[@class="player-heading"]
?exists: $tournament
$body: $tournament
$img: $tournament//img
image_url: $img/@src
cover: $img
#@remove: $img
#@append_to($body): $img

$table: //*[has-class("user-detail-bio")]
$row: $table//div[has-class("col-xs-6")]
$td: $table//div[has-class("col-xs-6")]/*


@wrap(<td>): $td

$td: $table//div[has-class("col-xs-12")]/*

@remove:  $table//div[has-class("col-xs-12")]/span
@wrap(<td>): $td
$get: $@
<tr>: $row
<tr>: $table//div[has-class("col-xs-12")]
@debug
@wrap_inner(<table>): $table
$h2: $table//h2
#@wrap(<strong>): $h2

$pgal: //*[@id="article-gallery"]//div[has-class("col-md-2")]
$info: //*[@id="article-gallery"]//*[has-class("article-box-info")]
<h3>: $info//span[1]
<p>: $info//span[2]
@append_to($body): $info
@set_attr(src, $pgal//a/@href): $pgal//img
@append_to($body): $pgal
<slideshow> : $pgal

?true:


# twitter-tweet
<iframe>: //twitter-widget[starts-with(@data-tweet-id,"https://twitter.com/")]
@set_attr(src,./@data-tweet-id): $@
@replace:

# PIC RULES
# By @housemusicforhomelessepeople
<pic>: //img[ancestor::td]

@set_attr("href",./img): //a[./img]/@href

@after_el("./.."): //p/iframe
@after_el("./.."): //a/img

@after_el("./.."): //p/related

# STYLING (add it if you want)
# <aside>: //*[@style="text-align: center;"]

# REPLACING srcset WITH src
# NOTE THAT IV DO NOT SUPPORT srcset!
# SAFE IF IV STARTS SUPPORTING srcset
# By @housemusicforhomelessepeople
$setsrc: $body//img[@srcset]
@set_attr(src_set, @srcset):
@replace("http.+w, ", ""): $setsrc/@src_set
@replace("(jpe?g|png|gif).+w", "$1"): $setsrc/@src_set
@set_attr(src, @src_set): $setsrc

# YOUTUBE OBJECT FIXER
# By @housemusicforhomelessepeople
@if("//object[contains(@data, \"youtube\")]") {
  @before(<iframe>): //object[contains(@data, \"youtube\")]
  @replace("http://www.youtube.com/v/","https://www.youtube.com/embed/"): //object[contains(@data, "youtube")]/@data
  @set_attr(src, "./next-sibling::object[contains(@data, \"youtube\")]/@data"): //iframe[next-sibling::object[contains(@data, "youtube")]]
  @remove: //object[contains(@data, "youtube")]
}


@after(<br>): $body//blockquote//p

# REPLACE BODY !!!

title: //h1
?exists: //article[div[has-class("article")]]
$body: //article
@remove: //*[has-class("banner")]
@remove: //*[has-class("fb-like")]
@remove: //*[has-class("resp-sharing-button__container")]

<related>: //*[has-class("article-box")]
$x: $@
<h3>: $x//span[has-class("article-box-title-small")]
@debug
# REPLACE BODY !!!

title: //meta[@property="og:title"]/@content
description: //meta[@name="description"]/@content
cover: $body//figure
cover: $body//img
image_url: //meta[@property="og:image"]/@content
image_url: $body//img/@src
site_name: //meta[@property="site_name"]/@content
# @if(//*[has-class("article-author")]  ) {
#   @clone: //*[has-class("article-author")]
# $to_aut: $@
# @match("^.+(, fo)"): $to_aut
# $author: $@
# @replace(", fo", ""): $author
# author: $author
# @wrap(<toremove>):  //*[has-class("article-author")][1]
# @remove: //toremove
# }
author: //*[has-class("article-author")]
$dt_field: //*[has-class("article-heading-info")]//span[has-class("author")]
@datetime(0, "cs_CZ", "dd. M. yyyy"): $dt_field
$dt: $@
published_date: $dt
$check:  $dt_field[contains(text(),"DNES")]
@if( $check) {
  @replace("DNES", "today"): $dt_field
  $xc: $@
  @datetime(0): $xc
  published_date!: $@
}

$check:  $dt_field[contains(text(),"VČERA")]
@if( $check) {
  @replace("VČERA", "yesterday"): $dt_field
  $xc: $@
  @datetime(0): $xc
  published_date!: $@
}
@remove: //*[has-class("article-heading-info")]
@remove: //*[has-class("article-author")]
#=====LET ME DIE=====
#Original code/idea by Misho @mushi_f
#With modifications by Andrei Afanasiev
body: $body

$problems: $body
@while( $problems ) {
  $test: $body//*[self::blockquote or self::aside or self::figure or (self::img and not(./ancestor::figure)) or self::iframe or self::slideshow or self::related or self::footer or self::table[not(ancestor::table) and not(descendant::table)]]

  $problems: $test/self::*[ancestor::anchor or ancestor::blockquote or ancestor::aside or ancestor::footer or ancestor::strong or ancestor::b or ancestor::em or ancestor::i or ancestor::ins or ancestor::u or ancestor::del or ancestor::s or ancestor::strike or ancestor::code or ancestor::kbd or ancestor::samp or ancestor::tt or ancestor::mark or ancestor::sup or ancestor::pic or ancestor::sub or ancestor::a or ancestor::reference or ancestor::h1 or ancestor::h2 or ancestor::h3 or ancestor::h4 or ancestor::h5 or ancestor::h6 or ancestor::p or ancestor::pre or ancestor::hr or ancestor::img or ancestor::br]

  @if( $problems ) {
    $parent: $problems/parent::*
    @detach: $parent/node()
    @set_attr("merge", $index): $@
    <remove>: $parent
    @after_el("./parent::*"): $problems
    @combine: $body//self::*[prev-sibling::*/@merge = @merge]
  }
}
#====================
